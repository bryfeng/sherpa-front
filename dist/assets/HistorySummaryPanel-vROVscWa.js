import{d9 as $,dd as L,d6 as e,d7 as U,ek as k,el as W,dY as h,d_ as z}from"./index-rkOzlyuE.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A=$("Clock3",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16.5 12",key:"1aq6pp"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=$("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=$("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);function B(t){return L.useMemo(()=>{var c;const s=(t==null?void 0:t.notableEvents)??[],a=(t==null?void 0:t.exportRefs)??[],o=a.filter(x=>x.status==="ready"),r=a.filter(x=>x.status!=="ready"),n=(t==null?void 0:t.metadata)??{},l=typeof n.sampleLimit=="number"?n.sampleLimit:null;return{events:s,readyExports:o,pendingExports:r,hasHighlights:s.length>0,hasExports:a.length>0,nextDownloadUrl:((c=o[0])==null?void 0:c.downloadUrl)??null,metadata:n,isLimitSample:typeof n.sampleLimit=="number",isWindowClamped:!!n.windowClamped,limitCount:l,queueInfo:n.queuedExportId?{exportId:n.queuedExportId,reason:n.queuedReason,retryAfterSeconds:n.retryAfterSeconds}:null}},[t])}const C={info:{icon:e.jsx(k,{size:14,"aria-hidden":!0}),accent:"var(--accent)",border:"rgba(90,164,255,.35)",background:"rgba(90,164,255,.08)",iconBg:"rgba(90,164,255,.18)"},warning:{icon:e.jsx(U,{size:14,"aria-hidden":!0}),accent:"var(--warning)",border:"rgba(255,204,102,.35)",background:"rgba(255,204,102,.12)",iconBg:"rgba(255,204,102,.24)"},critical:{icon:e.jsx(T,{size:14,"aria-hidden":!0}),accent:"var(--danger)",border:"rgba(255,107,107,.35)",background:"rgba(255,107,107,.12)",iconBg:"rgba(255,107,107,.2)"}};function I({event:t}){const s=t.severity||"info",a=C[s]??C.info;return e.jsxs("div",{className:"flex items-start gap-[var(--s1)] rounded-2xl border px-[var(--s2)] py-[var(--s1)] text-sm",style:{background:a.background,borderColor:a.border},children:[e.jsx("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full",style:{background:a.iconBg,color:a.accent},"aria-hidden":!0,children:a.icon}),e.jsxs("div",{className:"space-y-[var(--s-1)]",children:[e.jsx("p",{className:"font-semibold capitalize",style:{color:a.accent},children:t.type.replace("_"," ")}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:t.summary})]})]})}function V({widget:t}){const s=t.payload,{events:a,readyExports:o,pendingExports:r,nextDownloadUrl:n,metadata:l,isLimitSample:c,isWindowClamped:x,limitCount:v}=B(s);if(!s)return e.jsx("div",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No history data available for this wallet."});const u=s.totals,S=(s.buckets??[]).slice(0,3),f=`history-summary-${t.id}`,m=c?void 0:`${f}-range`,q=M(s.timeWindow.start,s.timeWindow.end),b=l.requestedWindow?M(l.requestedWindow.start,l.requestedWindow.end):null,p=[],E=u.inflowUsd===0&&u.outflowUsd===0&&u.feeUsd===0&&(s.buckets??[]).every(i=>{var d;return(((d=i.transactionsSample)==null?void 0:d.length)??0)===0});if(!c&&x&&b){const i=l.clampedWindowDays??90;p.push({tone:"warning",message:`${b?`${b} `:"The requested range "}exceeds the 90-day sync limit. Showing the latest ${i} days for fast summaries—request an export for the full window.`})}if(r.length>0){const i=r.length>1?"s":"",d=O(l.retryAfterSeconds);p.push({tone:"info",message:`${r.length} export${i} still generating${d?` (~${d})`:""}. We'll drop the download link here when it's ready.`})}return c&&E&&p.push({tone:"info",message:`No transfers found in the latest ${v??"requested"} transactions. Try a wider range or confirm the wallet address.`}),e.jsxs("section",{"aria-labelledby":f,...m?{"aria-describedby":m}:{},className:"space-y-[var(--s3)]",children:[e.jsxs("header",{className:"flex flex-wrap items-start justify-between gap-[var(--s2)]",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] font-semibold uppercase tracking-[0.2em]",style:{color:"var(--text-muted)"},children:"History summary"}),e.jsx("h3",{id:f,className:"text-lg font-semibold",style:{color:"var(--text)"},children:c&&v?`Latest ${v.toLocaleString()} transactions`:"Recent activity"}),!c&&m?e.jsxs("p",{id:m,className:"text-xs",style:{color:"var(--text-muted)"},children:["Window ",q]}):null]}),e.jsxs("div",{className:"text-right text-xs",style:{color:"var(--text-muted)"},children:[e.jsxs("span",{role:"status",children:["Updated ",D(s.generatedAt)]}),s.cached?e.jsx("p",{className:"text-[11px]",children:"served from cache"}):null]})]}),p.map((i,d)=>e.jsx(F,{tone:i.tone,children:i.message},`${i.tone}-${d}`)),e.jsxs(W,{columns:3,children:[e.jsx(y,{label:"Total inflow",value:u.inflowUsd,tone:"success"}),e.jsx(y,{label:"Total outflow",value:u.outflowUsd,tone:"warning"}),e.jsx(y,{label:"Fees paid",value:u.feeUsd,tone:"muted"})]}),e.jsxs("div",{className:"space-y-[var(--s1)]",children:[e.jsx(j,{children:"Recent buckets"}),S.length?e.jsx("div",{className:"space-y-[var(--s1)]",children:S.map(i=>e.jsx(H,{bucket:i},i.start))}):e.jsx(h,{tone:"muted",padding:"sm",className:"text-sm",style:{color:"var(--text-muted)"},children:"No transactions recorded."})]}),a.length?e.jsxs("div",{className:"space-y-[var(--s1)]","aria-live":"polite",children:[e.jsx(j,{icon:e.jsx(k,{size:14,"aria-hidden":!0}),children:"Highlights"}),e.jsx("div",{className:"grid gap-[var(--s1)] md:grid-cols-2",children:a.map((i,d)=>e.jsx(I,{event:i},`${i.type}-${d}`))})]}):null,e.jsxs("div",{className:"space-y-[var(--s1)]",children:[e.jsx(j,{icon:e.jsx(w,{size:12,"aria-hidden":!0}),children:"Exports"}),e.jsx(_,{exports:s.exportRefs,pendingExports:r,readyExports:o,nextDownloadUrl:n})]})]})}const R={success:{accent:"var(--success)",bg:"rgba(95,211,154,.14)",border:"rgba(95,211,154,.32)"},warning:{accent:"var(--warning)",bg:"rgba(255,204,102,.16)",border:"rgba(255,204,102,.35)"},muted:{accent:"var(--text)",bg:"var(--surface-2)",border:"var(--line)"}};function y({label:t,value:s,tone:a}){const o=R[a];return e.jsxs("div",{role:"listitem",className:"rounded-2xl border px-[var(--s2)] py-[var(--s1)]",style:{background:o.bg,borderColor:o.border},children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide",style:{color:"var(--text-muted)"},children:t}),e.jsx("p",{className:"text-2xl font-semibold",style:{color:o.accent},children:N(s)})]})}function H({bucket:t}){const s=t.transactionsSample??[],a=(t.inflowUsd??0)-(t.outflowUsd??0),o=a>0?"var(--success)":a<0?"var(--danger)":"var(--text)";return e.jsxs(h,{padding:"sm",className:"space-y-[var(--s1)]","aria-label":`Bucket starting ${g(t.start)}`,style:{borderColor:"var(--line)"},children:[e.jsxs("div",{className:"flex items-center justify-between gap-[var(--s1)] text-sm",children:[e.jsxs("div",{className:"flex items-center gap-[var(--s1)]",style:{color:"var(--text)"},children:[e.jsx(A,{className:"h-4 w-4",style:{color:"var(--text-muted)"},"aria-hidden":!0}),e.jsx("span",{children:g(t.start)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[11px] uppercase tracking-wide",style:{color:"var(--text-muted)"},children:"Net USD"}),e.jsx("p",{className:"font-semibold",style:{color:o},children:N(a)})]})]}),s.length>0&&e.jsx("div",{className:"grid gap-[var(--s-1)] text-xs","aria-label":"Sample transactions",children:s.map((r,n)=>{const l=r.direction==="inflow"?"var(--success)":"var(--danger)",c=r,x=r.symbol||c.protocol||c.protocol_name||c.tx_type||"Txn";return e.jsxs("div",{className:"flex items-center justify-between rounded-lg border px-[var(--s1)] py-[var(--s-1)]",style:{borderColor:"var(--line)",background:"var(--surface)"},children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--text-muted)"},children:x}),e.jsxs("span",{style:{color:l},children:[r.direction==="inflow"?"+":"-",N(r.usd_value??0)]})]},r.tx_hash??`${t.start}-${n}`)})})]})}function _({exports:t,pendingExports:s,readyExports:a,nextDownloadUrl:o}){return t!=null&&t.length?e.jsxs("div",{className:"space-y-[var(--s1)]","aria-label":"History exports",children:[t.map(r=>{const n=`Expires ${D(r.expiresAt,!0)}`,l=r.status==="failed"?"var(--danger)":"var(--text-muted)";return e.jsxs(h,{padding:"sm",className:"flex flex-wrap items-center justify-between gap-[var(--s1)]",style:{borderColor:"var(--line)"},children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:[r.format.toUpperCase()," · ",r.status]}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:n})]}),r.downloadUrl&&r.status==="ready"?e.jsxs("a",{className:"inline-flex items-center gap-[var(--s-1)] rounded-full border border-transparent bg-[var(--accent)] px-[var(--s2)] py-[var(--s-1)] text-xs font-semibold text-[var(--text-inverse)] shadow-sm transition hover:bg-[var(--accent-600)]",href:r.downloadUrl,target:"_blank",rel:"noreferrer",children:[e.jsx(w,{size:14,"aria-hidden":!0})," Download"]}):e.jsx("span",{className:"text-xs font-medium",style:{color:l},role:"status",children:r.status==="failed"?"Failed":"Preparing..."})]},r.exportId)}),e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-[var(--s1)] text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("span",{children:s.length>0?`${s.length} export${s.length>1?"s":""} still generating.`:`All ${a.length||"saved"} exports ready.`}),e.jsxs(z,{variant:"secondary",size:"sm",className:"font-semibold",disabled:!o,onClick:()=>{o&&window.open(o,"_blank","noopener")},children:[e.jsx(w,{size:12,"aria-hidden":!0})," Download latest"]})]})]}):e.jsx(h,{tone:"muted",padding:"sm",className:"text-sm",style:{color:"var(--text-muted)"},children:"Request an export from chat to download CSV or JSON activity logs."})}function j({children:t,icon:s}){return e.jsxs("div",{className:"flex items-center gap-[var(--s-1)] text-[11px] font-semibold uppercase tracking-[0.2em]",style:{color:"var(--text-muted)"},children:[s&&e.jsx("span",{"aria-hidden":!0,children:s}),e.jsx("span",{children:t})]})}function F({tone:t,children:s}){const a=t==="warning"?{bg:"rgba(255,204,102,.12)",border:"rgba(255,204,102,.35)",icon:e.jsx(U,{size:16,"aria-hidden":!0}),color:"var(--warning)"}:{bg:"rgba(90,164,255,.12)",border:"rgba(90,164,255,.32)",icon:e.jsx(k,{size:16,"aria-hidden":!0}),color:"var(--text)"};return e.jsxs("div",{className:"flex items-start gap-[var(--s1)] rounded-2xl border px-[var(--s2)] py-[var(--s1)] text-sm",style:{background:a.bg,borderColor:a.border,color:a.color},role:"status",children:[e.jsx("span",{className:"mt-[2px]","aria-hidden":!0,children:a.icon}),e.jsx("span",{children:s})]})}function N(t){return Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(t??0)}function g(t){return new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric"})}function M(t,s){return!t||!s?"n/a":`${g(t)} – ${g(s)}`}function D(t,s=!1){const a=new Date(t).getTime(),o=Date.now(),r=s?a-o:o-a,n=Math.floor(r/6e4);if(Math.abs(n)<60)return`${Math.max(1,Math.abs(n))}m`;const l=Math.floor(n/60);if(Math.abs(l)<24)return`${Math.abs(l)}h`;const c=Math.floor(l/24);return`${Math.abs(c)}d`}function O(t){if(!t)return null;if(t<60)return`${Math.max(1,Math.round(t))}s`;const s=Math.ceil(t/60);return s<60?`${s}m`:`${Math.ceil(s/60)}h`}export{V as HistorySummaryPanel};
