import{ai as b,aj as $,ak as u,T as m,al as c,I as d,K as z,am as k,D as H,an as j,ao as A,ap as N,aq as O,V as I,ar as T}from"./index-UrrZCscU.js";const B=`Ethereum Signed Message:
`;function C(e){const t=typeof e=="string"?b(e):typeof e.raw=="string"?e.raw:$(e.raw),r=b(`${B}${u(t)}`);return m([r,t])}function U(e,t){return c(C(e),t)}class R extends d{constructor({domain:t}){super(`Invalid domain "${z(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class V extends d{constructor({primaryType:t,types:r}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(r))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class W extends d{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function F(e){const{domain:t,message:r,primaryType:s,types:n}=e,a=(i,p)=>{for(const w of i){const{name:P,type:f}=w,o=p[P],h=f.match(k);if(h&&(typeof o=="number"||typeof o=="bigint")){const[S,y,M]=h;H(o,{signed:y==="int",size:Number.parseInt(M,10)/8})}if(f==="address"&&typeof o=="string"&&!j(o))throw new A({address:o});const g=f.match(N);if(g){const[S,y]=g;if(y&&u(o)!==Number.parseInt(y,10))throw new O({expectedSize:Number.parseInt(y,10),givenSize:u(o)})}const l=n[f];l&&(J(f),a(l,o))}};if(n.EIP712Domain&&t){if(typeof t!="object")throw new R({domain:t});a(n.EIP712Domain,t)}if(s!=="EIP712Domain")if(n[s])a(n[s],r);else throw new V({primaryType:s,types:n})}function q({domain:e}){return[typeof(e==null?void 0:e.name)=="string"&&{name:"name",type:"string"},(e==null?void 0:e.version)&&{name:"version",type:"string"},(typeof(e==null?void 0:e.chainId)=="number"||typeof(e==null?void 0:e.chainId)=="bigint")&&{name:"chainId",type:"uint256"},(e==null?void 0:e.verifyingContract)&&{name:"verifyingContract",type:"address"},(e==null?void 0:e.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function J(e){if(e==="address"||e==="bool"||e==="string"||e.startsWith("bytes")||e.startsWith("uint")||e.startsWith("int"))throw new W({type:e})}function X(e){const{domain:t={},message:r,primaryType:s}=e,n={EIP712Domain:q({domain:t}),...e.types};F({domain:t,message:r,primaryType:s,types:n});const a=["0x1901"];return t&&a.push(K({domain:t,types:n})),s!=="EIP712Domain"&&a.push(x({data:r,primaryType:s,types:n})),c(m(a))}function K({domain:e,types:t}){return x({data:e,primaryType:"EIP712Domain",types:t})}function x({data:e,primaryType:t,types:r}){const s=E({data:e,primaryType:t,types:r});return c(s)}function E({data:e,primaryType:t,types:r}){const s=[{type:"bytes32"}],n=[G({primaryType:t,types:r})];for(const a of r[t]){const[i,p]=v({types:r,name:a.name,type:a.type,value:e[a.name]});s.push(i),n.push(p)}return I(s,n)}function G({primaryType:e,types:t}){const r=T(L({primaryType:e,types:t}));return c(r)}function L({primaryType:e,types:t}){let r="";const s=D({primaryType:e,types:t});s.delete(e);const n=[e,...Array.from(s).sort()];for(const a of n)r+=`${a}(${t[a].map(({name:i,type:p})=>`${p} ${i}`).join(",")})`;return r}function D({primaryType:e,types:t},r=new Set){const s=e.match(/^\w*/u),n=s==null?void 0:s[0];if(r.has(n)||t[n]===void 0)return r;r.add(n);for(const a of t[n])D({primaryType:a.type,types:t},r);return r}function v({types:e,name:t,type:r,value:s}){if(e[r]!==void 0)return[{type:"bytes32"},c(E({data:s,primaryType:r,types:e}))];if(r==="bytes")return s=`0x${(s.length%2?"0":"")+s.slice(2)}`,[{type:"bytes32"},c(s)];if(r==="string")return[{type:"bytes32"},c(T(s))];if(r.lastIndexOf("]")===r.length-1){const n=r.slice(0,r.lastIndexOf("[")),a=s.map(i=>v({name:t,type:n,types:e,value:i}));return[{type:"bytes32"},c(I(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:r},s]}export{X as a,U as h};
