import{dM as U,dU as i,eD as O,dT as I,dO as e,er as T,dR as W,eE as P,eF as q,ek as F,eG as H,eH as _}from"./index-DkD0KfRO.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=U("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=U("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);function L(d){switch(d){case"active":return"var(--success)";case"expired":return"var(--warning)";case"revoked":return"var(--error)";case"exhausted":return"var(--text-muted)";default:return"var(--text-muted)"}}function J(d){const v=Date.now(),t=d-v;return Math.max(0,Math.ceil(t/(24*60*60*1e3)))}function Q(d){const t=Date.now()-d,l=Math.floor(t/6e4),n=Math.floor(t/36e5),x=Math.floor(t/864e5);return l<1?"just now":l<60?`${l}m ago`:n<24?`${n}h ago`:`${x}d ago`}function K({sessionId:d,permissions:v,maxValuePerTxUsd:t,maxTotalValueUsd:l,totalValueUsedUsd:n,transactionCount:x,maxTransactions:c,chainAllowlist:a,status:r,expiresAt:f,createdAt:h,lastUsedAt:C,onRevoke:y,onExtend:D}){const[p,g]=i.useState(!1),[b,S]=i.useState(""),[M,m]=i.useState(!1),[E,A]=i.useState(!1),N=l>0?n/l*100:0,R=J(f),s=r==="active"&&R<=7,o=r==="active"&&N>=80,j=async()=>{if(b.trim()){m(!0);try{await y(d,b)}finally{m(!1),g(!1)}}},z=async u=>{A(!0);try{await D(d,u)}finally{A(!1),g(!1)}},B=v.map(u=>{var k;return((k=O.find($=>$.key===u))==null?void 0:k.label)||u}).join(", "),V=a.map(u=>{var k;return((k=I.find($=>$.chainId===u))==null?void 0:k.name)||`Chain ${u}`}).join(", ");return e.jsxs("div",{className:"rounded-xl border overflow-hidden",style:{borderColor:"var(--line)",background:"var(--surface-2)"},children:[e.jsxs("div",{className:"flex items-center justify-between px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg",style:{background:"var(--surface-3)"},children:e.jsx(w,{className:"h-4 w-4",style:{color:L(r)}})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium",style:{color:"var(--text)"},children:[d.slice(0,12),"..."]}),e.jsx("span",{className:"rounded-full px-2 py-0.5 text-[10px] font-medium uppercase",style:{background:`${L(r)}20`,color:L(r)},children:r})]}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:B})]})]}),r==="active"&&e.jsx("button",{type:"button",onClick:()=>g(!p),className:"rounded-lg border px-2.5 py-1 text-xs font-medium transition hover:bg-[var(--surface-3)]",style:{borderColor:"var(--line)",color:"var(--text-muted)"},children:"Manage"})]}),e.jsxs("div",{className:"px-4 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"text-xs",style:{color:"var(--text-muted)"},children:["Budget: ",T(n)," / ",T(l)," used"]}),e.jsxs("span",{className:"text-xs font-medium",style:{color:o?"var(--warning)":"var(--text)"},children:[N.toFixed(0),"%"]})]}),e.jsx("div",{className:"h-1.5 rounded-full overflow-hidden",style:{background:"var(--surface-3)"},children:e.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(N,100)}%`,background:o?"var(--warning)":"var(--accent)"}})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-px border-t",style:{borderColor:"var(--line)",background:"var(--line)"},children:[e.jsxs("div",{className:"px-3 py-2",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] uppercase",style:{color:"var(--text-muted)"},children:"Expires"}),e.jsxs("p",{className:"text-xs font-medium flex items-center gap-1",style:{color:s?"var(--warning)":"var(--text)"},children:[s&&e.jsx(W,{className:"h-3 w-3"}),R,"d"]})]}),e.jsxs("div",{className:"px-3 py-2",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] uppercase",style:{color:"var(--text-muted)"},children:"Transactions"}),e.jsxs("p",{className:"text-xs font-medium",style:{color:"var(--text)"},children:[x,c&&` / ${c}`]})]}),e.jsxs("div",{className:"px-3 py-2",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-[10px] uppercase",style:{color:"var(--text-muted)"},children:"Last used"}),e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text)"},children:C?Q(C):"Never"})]})]}),e.jsxs("div",{className:"px-4 py-2 border-t text-xs",style:{borderColor:"var(--line)",color:"var(--text-muted)"},children:["Chains: ",V]}),p&&r==="active"&&e.jsxs("div",{className:"border-t px-4 py-3 space-y-3",style:{borderColor:"var(--line)",background:"var(--surface)"},children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium mb-2",style:{color:"var(--text)"},children:"Extend Session"}),e.jsx("div",{className:"flex gap-2",children:[7,30,90].map(u=>e.jsxs("button",{type:"button",onClick:()=>z(u),disabled:E,className:"flex-1 rounded-lg border py-1.5 text-xs font-medium transition hover:bg-[var(--surface-2)]",style:{borderColor:"var(--line)",color:"var(--text)"},children:[e.jsx(P,{className:"h-3 w-3 inline mr-1"}),u,"d"]},u))})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium mb-2",style:{color:"var(--error)"},children:"Revoke Session"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",placeholder:"Reason for revoking...",value:b,onChange:u=>S(u.target.value),className:"flex-1 rounded-lg border px-3 py-1.5 text-xs",style:{borderColor:"var(--line)",background:"var(--surface-2)",color:"var(--text)"}}),e.jsx("button",{type:"button",onClick:j,disabled:!b.trim()||M,className:"rounded-lg px-3 py-1.5 text-xs font-medium transition disabled:opacity-50",style:{background:"var(--error)",color:"white"},children:e.jsx(q,{className:"h-3.5 w-3.5"})})]})]})]})]})}function X({sessions:d,isLoading:v,onRevoke:t,onExtend:l}){if(v)return e.jsx("div",{className:"space-y-3",children:[1,2].map(a=>e.jsxs("div",{className:"animate-pulse rounded-xl border p-4",style:{borderColor:"var(--line)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg",style:{background:"var(--surface-3)"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-32 rounded mb-1",style:{background:"var(--surface-3)"}}),e.jsx("div",{className:"h-3 w-24 rounded",style:{background:"var(--surface-3)"}})]})]}),e.jsx("div",{className:"h-2 rounded-full",style:{background:"var(--surface-3)"}})]},a))});if(d.length===0)return e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-xl border p-8 text-center",style:{borderColor:"var(--line)",background:"var(--surface-2)"},children:[e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-xl",style:{background:"var(--surface-3)"},children:e.jsx(w,{className:"h-6 w-6",style:{color:"var(--text-muted)"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:"No Active Sessions"}),e.jsx("p",{className:"mt-1 text-xs",style:{color:"var(--text-muted)"},children:"Create a session key to allow agents to trade on your behalf"})]})]});const n=[...d].sort((a,r)=>{const f={active:0,expired:1,exhausted:2,revoked:3},h=f[a.status]-f[r.status];return h!==0?h:r.createdAt-a.createdAt}),x=n.filter(a=>a.status==="active"),c=n.filter(a=>a.status!=="active");return e.jsxs("div",{className:"space-y-4",children:[x.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-muted)"},children:["Active Sessions (",x.length,")"]}),x.map(a=>e.jsx(K,{...a,onRevoke:t,onExtend:l},a.sessionId))]}),x.some(a=>{const r=Math.ceil((a.expiresAt-Date.now())/864e5);return r<=7&&r>0})&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",style:{borderColor:"var(--warning)",background:"var(--warning)/5"},children:[e.jsx(F,{className:"h-4 w-4 flex-shrink-0",style:{color:"var(--warning)"}}),e.jsx("p",{className:"text-xs",style:{color:"var(--warning)"},children:"Some sessions are expiring soon. Extend them to avoid interruption."})]}),c.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("h4",{className:"text-xs font-medium uppercase tracking-wide",style:{color:"var(--text-muted)"},children:["Past Sessions (",c.length,")"]}),c.slice(0,3).map(a=>e.jsx(K,{...a,onRevoke:t,onExtend:l},a.sessionId)),c.length>3&&e.jsxs("p",{className:"text-center text-xs",style:{color:"var(--text-muted)"},children:["+ ",c.length-3," more past sessions"]})]})]})}function Y({onSubmit:d,onCancel:v}){const[t,l]=i.useState(["swap"]),[n,x]=i.useState(100),[c,a]=i.useState(5e3),[r,f]=i.useState(void 0),[h,C]=i.useState(!0),[y,D]=i.useState([1]),[p,g]=i.useState(90),[b,S]=i.useState(!1),[M,m]=i.useState(null),E=i.useCallback(s=>{l(o=>o.includes(s)?o.filter(j=>j!==s):[...o,s]),m(null)},[]),A=i.useCallback(s=>{D(o=>o.includes(s)?o.filter(j=>j!==s):[...o,s]),m(null)},[]),N=async()=>{if(t.length===0){m("Select at least one permission");return}if(y.length===0){m("Select at least one chain");return}if(n<=0){m("Per-transaction limit must be greater than 0");return}if(c<=0){m("Total budget must be greater than 0");return}if(n>c){m("Per-transaction limit cannot exceed total budget");return}const s={permissions:t,valueLimits:{maxValuePerTxUsd:n,maxTotalValueUsd:c,maxTransactions:h?void 0:r},chainAllowlist:y,tokenAllowlist:[],contractAllowlist:[],expiresAt:Date.now()+p*24*60*60*1e3,durationDays:p};S(!0);try{await d(s)}catch(o){m(o instanceof Error?o.message:"Failed to create session key")}finally{S(!1)}},R=new Date(Date.now()+p*24*60*60*1e3);return e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl",style:{background:"var(--surface-2)"},children:e.jsx(w,{className:"h-5 w-5",style:{color:"var(--accent)"}})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold",style:{color:"var(--text)"},children:"Create Session Key"}),e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Define what this agent can do autonomously"})]})]}),M&&e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border px-3 py-2",style:{borderColor:"var(--error)",background:"var(--error)/10",color:"var(--error)"},children:[e.jsx(F,{className:"h-4 w-4 flex-shrink-0"}),e.jsx("p",{className:"text-xs",children:M})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-2 block",style:{color:"var(--text)"},children:"Allowed Actions"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:O.map(s=>e.jsxs("button",{type:"button",onClick:()=>E(s.key),className:`flex items-center gap-2 rounded-lg border px-3 py-2 text-left transition ${t.includes(s.key)?"border-[var(--accent)] bg-[var(--accent)]/10":"border-[var(--line)] hover:border-[var(--accent)]/50"}`,children:[e.jsx("div",{className:`h-4 w-4 rounded border flex items-center justify-center ${t.includes(s.key)?"border-[var(--accent)] bg-[var(--accent)]":"border-[var(--line)]"}`,children:t.includes(s.key)&&e.jsx("svg",{className:"h-3 w-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}),e.jsx("div",{children:e.jsx("p",{className:"text-xs font-medium",style:{color:"var(--text)"},children:s.label})})]},s.key))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-2 block",style:{color:"var(--text)"},children:"Spending Limits"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] mb-1 block",style:{color:"var(--text-muted)"},children:"Max per transaction"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm",style:{color:"var(--text-muted)"},children:"$"}),e.jsx("input",{type:"number",value:n,onChange:s=>{x(parseFloat(s.target.value)||0),m(null)},className:"w-full rounded-lg border py-2 pl-7 pr-3 text-sm",style:{borderColor:"var(--line)",background:"var(--surface-2)",color:"var(--text)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[11px] mb-1 block",style:{color:"var(--text-muted)"},children:"Total session budget"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-sm",style:{color:"var(--text-muted)"},children:"$"}),e.jsx("input",{type:"number",value:c,onChange:s=>{a(parseFloat(s.target.value)||0),m(null)},className:"w-full rounded-lg border py-2 pl-7 pr-3 text-sm",style:{borderColor:"var(--line)",background:"var(--surface-2)",color:"var(--text)"}})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("label",{className:"text-[11px]",style:{color:"var(--text-muted)"},children:"Max transactions"}),e.jsxs("label",{className:"flex items-center gap-1.5 text-[11px]",style:{color:"var(--text-muted)"},children:[e.jsx("input",{type:"checkbox",checked:h,onChange:s=>C(s.target.checked),className:"rounded"}),"Unlimited"]})]}),e.jsx("input",{type:"number",value:r||"",onChange:s=>f(parseInt(s.target.value)||void 0),disabled:h,placeholder:"e.g., 52",className:"w-full rounded-lg border py-2 px-3 text-sm disabled:opacity-50",style:{borderColor:"var(--line)",background:"var(--surface-2)",color:"var(--text)"}})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-2 block",style:{color:"var(--text)"},children:"Allowed Chains"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:I.map(s=>e.jsx("button",{type:"button",onClick:()=>A(s.chainId),className:`rounded-lg border px-3 py-1.5 text-xs font-medium transition ${y.includes(s.chainId)?"border-[var(--accent)] bg-[var(--accent)]/10 text-[var(--accent)]":"border-[var(--line)] hover:border-[var(--accent)]/50"}`,style:{color:y.includes(s.chainId)?"var(--accent)":"var(--text)"},children:s.name},s.chainId))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium mb-2 block",style:{color:"var(--text)"},children:"Session expires in"}),e.jsx("div",{className:"flex gap-2",children:H.map(s=>e.jsx("button",{type:"button",onClick:()=>g(s.days),className:`flex-1 rounded-lg border py-2 text-xs font-medium transition ${p===s.days?"border-[var(--accent)] bg-[var(--accent)]/10 text-[var(--accent)]":"border-[var(--line)] hover:border-[var(--accent)]/50"}`,style:{color:p===s.days?"var(--accent)":"var(--text)"},children:s.label},s.days))}),e.jsxs("p",{className:"mt-2 text-[11px]",style:{color:"var(--text-muted)"},children:["Expires: ",R.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]})]}),e.jsxs("div",{className:"rounded-xl border p-3",style:{borderColor:"var(--line)",background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-xs font-medium mb-2",style:{color:"var(--text)"},children:"Summary"}),e.jsxs("ul",{className:"space-y-1 text-xs",style:{color:"var(--text-muted)"},children:[e.jsx("li",{children:t.length>0?`Can ${t.join(", ")}`:"No permissions selected"}),e.jsxs("li",{children:["Up to ",T(n)," per transaction"]}),e.jsxs("li",{children:["Maximum ",T(c)," total"]}),e.jsxs("li",{children:["On ",y.length>0?y.map(s=>{var o;return(o=I.find(j=>j.chainId===s))==null?void 0:o.name}).join(", "):"no chains selected"]}),e.jsxs("li",{children:["Valid for ",p," days"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:v,className:"flex-1 rounded-lg border py-2.5 text-xs font-medium transition hover:bg-[var(--surface-2)]",style:{borderColor:"var(--line)",color:"var(--text)"},children:"Cancel"}),e.jsxs("button",{type:"button",onClick:N,disabled:b||t.length===0||y.length===0,className:"flex-1 flex items-center justify-center gap-1.5 rounded-lg py-2.5 text-xs font-medium transition disabled:opacity-50",style:{background:"var(--accent)",color:"white"},children:[e.jsx(P,{className:"h-3.5 w-3.5"}),b?"Creating...":"Create Session Key"]})]})]})}function ee({widget:d,walletAddress:v}){const[t,l]=i.useState("list"),{sessions:n,activeCount:x,isLoading:c,create:a,revoke:r,extend:f}=_({walletAddress:v,includeExpired:!0,includeRevoked:!0});return v?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-xl",style:{background:"var(--surface-2)"},children:e.jsx(w,{className:"h-5 w-5",style:{color:"var(--accent)"}})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:"Session Keys"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[x," active session",x!==1?"s":""]})]})]})}),e.jsxs("div",{className:"flex rounded-lg p-1",style:{background:"var(--surface-2)"},children:[e.jsxs("button",{type:"button",onClick:()=>l("list"),className:`flex-1 flex items-center justify-center gap-1.5 rounded-md py-2 text-xs font-medium transition ${t==="list"?"bg-[var(--surface)] shadow-sm":"hover:text-[var(--text)]"}`,style:{color:t==="list"?"var(--text)":"var(--text-muted)"},children:[e.jsx(G,{className:"h-3.5 w-3.5"}),"Sessions"]}),e.jsxs("button",{type:"button",onClick:()=>l("create"),className:`flex-1 flex items-center justify-center gap-1.5 rounded-md py-2 text-xs font-medium transition ${t==="create"?"bg-[var(--surface)] shadow-sm":"hover:text-[var(--text)]"}`,style:{color:t==="create"?"var(--text)":"var(--text-muted)"},children:[e.jsx(P,{className:"h-3.5 w-3.5"}),"Create New"]})]}),t==="list"?e.jsx(X,{sessions:n,isLoading:c,onRevoke:r,onExtend:f}):e.jsx(Y,{onSubmit:async h=>{await a(h),l("list")},onCancel:()=>l("list")})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3 rounded-xl border p-6 text-center",style:{borderColor:"var(--line)",background:"var(--surface-2)"},children:[e.jsx(w,{className:"h-8 w-8",style:{color:"var(--text-muted)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:"Connect Wallet"}),e.jsx("p",{className:"mt-1 text-xs",style:{color:"var(--text-muted)"},children:"Connect your wallet to manage session keys"})]})]})}export{ee as SessionKeysWidget};
