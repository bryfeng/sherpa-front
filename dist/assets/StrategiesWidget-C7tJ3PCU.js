import{d9 as w,da as Y,db as k,dd as d,dc as N,d6 as e,e_ as K,e8 as J,d7 as X,eH as Z,ej as q,eG as F,eh as ee,e$ as se,f0 as E}from"./index-B8UX-kGC.js";import{S as te}from"./settings-Dwa3vBI5.js";import{R as ae}from"./repeat-CSZA_a3S.js";import{T as L}from"./trending-up-DUekTB3I.js";import{S as le}from"./shield--DopWFue.js";import{C as ne}from"./chevron-up-DYPf3mJI.js";import{C as G}from"./chevron-down-BThiPcGt.js";/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=w("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=w("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=w("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=w("Pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=w("Play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]);/**
 * @license lucide-react v0.454.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=w("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]),ue={name:"",description:"",fromToken:null,toToken:null,amountPerExecutionUsd:100,frequency:"weekly",executionHourUtc:12,executionDayOfWeek:1,maxSlippageBps:100,maxGasUsd:5},xe={draft:"Draft",pending_session:"Pending Session",active:"Active",paused:"Paused",completed:"Completed",failed:"Failed",expired:"Expired"},B={draft:"var(--text-muted)",pending_session:"var(--warning)",active:"var(--success)",paused:"var(--warning)",completed:"var(--text-muted)",failed:"var(--error)",expired:"var(--error)"},H={hourly:"Every Hour",daily:"Daily",weekly:"Weekly",biweekly:"Every 2 Weeks",monthly:"Monthly",custom:"Custom"};function me(s,a){const n=Y(k.dca.listByWallet,s?{walletAddress:s,status:(a==null?void 0:a.status)==="all"||a==null?void 0:a.status}:"skip");return{strategies:d.useMemo(()=>{if(!n)return[];const o=[...n],l=(a==null?void 0:a.sortBy)??"created",h=(a==null?void 0:a.sortOrder)??"desc";return o.sort((f,y)=>{let m=0;switch(l){case"created":m=(f._creationTime??0)-(y._creationTime??0);break;case"nextExecution":m=(f.nextExecutionAt??1/0)-(y.nextExecutionAt??1/0);break;case"name":m=f.name.localeCompare(y.name);break;case"performance":m=f.totalAmountSpentUsd-y.totalAmountSpentUsd;break}return h==="asc"?m:-m}),o},[n,a==null?void 0:a.sortBy,a==null?void 0:a.sortOrder]),isLoading:n===void 0,isEmpty:n!==void 0&&n.length===0}}function pe(){const s=N(k.dca.create),a=N(k.dca.activate),n=N(k.dca.pause),c=N(k.dca.resume),o=N(k.dca.stop),l=N(k.dca.updateConfig),h=d.useCallback(async(r,i,t,u)=>{if(!u.fromToken||!u.toToken)throw new Error("Tokens are required");return await s({userId:r,walletId:i,walletAddress:t.toLowerCase(),name:u.name,description:u.description,fromToken:u.fromToken,toToken:u.toToken,amountPerExecutionUsd:u.amountPerExecutionUsd,frequency:u.frequency,cronExpression:u.cronExpression,executionHourUtc:u.executionHourUtc,executionDayOfWeek:u.executionDayOfWeek,executionDayOfMonth:u.executionDayOfMonth,maxSlippageBps:u.maxSlippageBps,maxGasUsd:u.maxGasUsd,skipIfGasAboveUsd:u.skipIfGasAboveUsd,pauseIfPriceAboveUsd:u.pauseIfPriceAboveUsd,pauseIfPriceBelowUsd:u.pauseIfPriceBelowUsd,maxTotalSpendUsd:u.maxTotalSpendUsd,maxExecutions:u.maxExecutions,endDate:u.endDate})},[s]),f=d.useCallback(async(r,i,t)=>await a({strategyId:r,sessionKeyId:i,nextExecutionAt:t??Date.now()+36e5}),[a]),y=d.useCallback(async(r,i)=>await n({strategyId:r,reason:i}),[n]),m=d.useCallback(async(r,i)=>await c({strategyId:r,nextExecutionAt:i??Date.now()+36e5}),[c]),j=d.useCallback(async r=>await o({strategyId:r}),[o]),p=d.useCallback(async(r,i)=>await l({strategyId:r,amountPerExecutionUsd:i.amountPerExecutionUsd,frequency:i.frequency,cronExpression:i.cronExpression,executionHourUtc:i.executionHourUtc,executionDayOfWeek:i.executionDayOfWeek,executionDayOfMonth:i.executionDayOfMonth,maxSlippageBps:i.maxSlippageBps,maxGasUsd:i.maxGasUsd,skipIfGasAboveUsd:i.skipIfGasAboveUsd,pauseIfPriceAboveUsd:i.pauseIfPriceAboveUsd,pauseIfPriceBelowUsd:i.pauseIfPriceBelowUsd,maxTotalSpendUsd:i.maxTotalSpendUsd,maxExecutions:i.maxExecutions,endDate:i.endDate}),[l]);return{create:h,activate:f,pause:y,resume:m,stop:j,updateConfig:p}}function ve(s){return s==="active"}function he(s){return s==="paused"}function fe(s){return s==="draft"||s==="paused"}function ye(s){return s==="active"||s==="paused"}function be(s){if(!s)return"Not scheduled";const a=Date.now(),n=s-a;if(n<0)return"Overdue";if(n<6e4)return"In less than a minute";if(n<36e5){const o=Math.round(n/6e4);return`In ${o} minute${o>1?"s":""}`}if(n<864e5){const o=Math.round(n/36e5);return`In ${o} hour${o>1?"s":""}`}const c=Math.round(n/864e5);return`In ${c} day${c>1?"s":""}`}function je(s){if(!s)return"Never";const n=Date.now()-s;if(n<6e4)return"Just now";if(n<36e5){const o=Math.round(n/6e4);return`${o} minute${o>1?"s":""} ago`}if(n<864e5){const o=Math.round(n/36e5);return`${o} hour${o>1?"s":""} ago`}const c=Math.round(n/864e5);return`${c} day${c>1?"s":""} ago`}function O(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:2}).format(s)}function ge(s,a){const n=parseFloat(s);return n===0?`0 ${a}`:n<.001?`<0.001 ${a}`:n<1?`${n.toFixed(4)} ${a}`:n<1e3?`${n.toFixed(2)} ${a}`:`${n.toLocaleString("en-US",{maximumFractionDigits:2})} ${a}`}function ke({strategy:s,onPause:a,onResume:n,onStop:c,onEdit:o,onViewDetails:l}){const[h,f]=d.useState(!1),[y,m]=d.useState(!1),j=s.totalExecutions>0?s.successfulExecutions/s.totalExecutions*100:0,p=async r=>{m(!0),f(!1);try{await r()}finally{m(!1)}};return e.jsxs("div",{className:"rounded-lg p-4 transition-colors hover:bg-opacity-80 cursor-pointer",style:{background:"var(--surface)",border:"1px solid var(--line)"},onClick:()=>l(s._id),children:[e.jsxs("div",{className:"flex items-start justify-between gap-3 mb-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h3",{className:"font-medium truncate",style:{color:"var(--text)"},children:s.name}),e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded-full shrink-0",style:{background:`${B[s.status]}20`,color:B[s.status]},children:xe[s.status]})]}),e.jsxs("p",{className:"text-xs truncate",style:{color:"var(--text-muted)"},children:[s.fromToken.symbol," → ",s.toToken.symbol]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:r=>{r.stopPropagation(),f(!h)},className:"p-1.5 rounded-md hover:bg-black/5 transition-colors",disabled:y,children:e.jsx(K,{className:"h-4 w-4",style:{color:"var(--text-muted)"}})}),h&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:r=>{r.stopPropagation(),f(!1)}}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 z-20 rounded-lg py-1 min-w-[140px] shadow-lg",style:{background:"var(--surface)",border:"1px solid var(--line)"},children:[ve(s.status)&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),p(()=>a(s._id))},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-black/5",style:{color:"var(--text)"},children:[e.jsx(ce,{className:"h-4 w-4"}),"Pause"]}),he(s.status)&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),p(()=>n(s._id))},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-black/5",style:{color:"var(--text)"},children:[e.jsx(ie,{className:"h-4 w-4"}),"Resume"]}),fe(s.status)&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),f(!1),o(s._id)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-black/5",style:{color:"var(--text)"},children:[e.jsx(te,{className:"h-4 w-4"}),"Edit"]}),ye(s.status)&&e.jsxs("button",{onClick:r=>{r.stopPropagation(),p(()=>c(s._id))},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-black/5",style:{color:"var(--error)"},children:[e.jsx(de,{className:"h-4 w-4"}),"Stop"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Per Buy"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:O(s.amountPerExecutionUsd)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 shrink-0",style:{color:"var(--accent)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Frequency"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:H[s.frequency]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4 shrink-0",style:{color:"var(--success)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Total Spent"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:O(s.totalAmountSpentUsd)})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 w-4 shrink-0 rounded-full flex items-center justify-center text-[10px] font-bold",style:{background:"var(--accent-muted)",color:"var(--accent)"},children:s.toToken.symbol.charAt(0)}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:"Acquired"}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:ge(s.totalTokensAcquired,s.toToken.symbol)})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 text-xs",style:{borderTop:"1px solid var(--line)"},children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-1",children:[j>=90?e.jsx(J,{className:"h-3 w-3",style:{color:"var(--success)"}}):j>=70?e.jsx(X,{className:"h-3 w-3",style:{color:"var(--warning)"}}):e.jsx(Z,{className:"h-3 w-3",style:{color:"var(--error)"}}),e.jsxs("span",{style:{color:"var(--text-muted)"},children:[s.successfulExecutions,"/",s.totalExecutions," executions"]})]})}),e.jsxs("div",{className:"flex items-center gap-1",style:{color:"var(--text-muted)"},children:[e.jsx(re,{className:"h-3 w-3"}),e.jsx("span",{children:s.status==="active"?be(s.nextExecutionAt):je(s.lastExecutionAt)})]})]}),y&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center rounded-lg bg-black/10",children:e.jsx("div",{className:"h-5 w-5 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--accent)"}})})]})}const Ne=[{value:"all",label:"All"},{value:"active",label:"Active"},{value:"paused",label:"Paused"},{value:"draft",label:"Draft"},{value:"completed",label:"Completed"},{value:"failed",label:"Failed"}];function we({strategies:s,isLoading:a,isEmpty:n,filters:c,onFiltersChange:o,onCreateNew:l,onPause:h,onResume:f,onStop:y,onEdit:m,onViewDetails:j}){const[p,r]=d.useState(""),i=s.filter(x=>{if(!p)return!0;const g=p.toLowerCase();return x.name.toLowerCase().includes(g)||x.fromToken.symbol.toLowerCase().includes(g)||x.toToken.symbol.toLowerCase().includes(g)}),t=s.filter(x=>x.status==="active").length,u=s.reduce((x,g)=>x+g.totalAmountSpentUsd,0);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"shrink-0 px-4 pt-4 pb-3",style:{borderBottom:"1px solid var(--line)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--text)"},children:"DCA Strategies"}),e.jsxs("p",{className:"text-xs",style:{color:"var(--text-muted)"},children:[t," active · ",new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(u)," invested"]})]}),e.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors",style:{background:"var(--accent)",color:"var(--text-inverse)"},children:[e.jsx(q,{className:"h-4 w-4"}),"New Strategy"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex-1 flex items-center gap-2 px-3 py-2 rounded-lg",style:{background:"var(--surface-2)",border:"1px solid var(--line)"},children:[e.jsx(F,{className:"h-4 w-4 shrink-0",style:{color:"var(--text-muted)"}}),e.jsx("input",{type:"text",placeholder:"Search strategies...",value:p,onChange:x=>r(x.target.value),className:"flex-1 bg-transparent text-sm outline-none",style:{color:"var(--text)"}})]}),e.jsx("select",{value:c.status??"all",onChange:x=>o({...c,status:x.target.value}),className:"px-3 py-2 rounded-lg text-sm outline-none cursor-pointer",style:{background:"var(--surface-2)",border:"1px solid var(--line)",color:"var(--text)"},children:Ne.map(x=>e.jsx("option",{value:x.value,children:x.label},x.value))})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:a?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(x=>e.jsxs("div",{className:"rounded-lg p-4 animate-pulse",style:{background:"var(--surface)",border:"1px solid var(--line)"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-5 w-32 rounded",style:{background:"var(--surface-2)"}}),e.jsx("div",{className:"h-5 w-16 rounded-full",style:{background:"var(--surface-2)"}})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[1,2,3,4].map(g=>e.jsx("div",{className:"h-10 rounded",style:{background:"var(--surface-2)"}},g))})]},x))}):n?e.jsx(Se,{onCreateNew:l}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(F,{className:"h-8 w-8 mb-3",style:{color:"var(--text-muted)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"No strategies match your search"})]}):e.jsx("div",{className:"space-y-3",children:i.map(x=>e.jsx(ke,{strategy:x,onPause:h,onResume:f,onStop:y,onEdit:m,onViewDetails:j},x._id))})})]})}function Se({onCreateNew:s}){return e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-full flex items-center justify-center mb-4",style:{background:"var(--accent-muted)"},children:e.jsx(L,{className:"h-8 w-8",style:{color:"var(--accent)"}})}),e.jsx("h3",{className:"text-lg font-medium mb-2",style:{color:"var(--text)"},children:"No strategies yet"}),e.jsx("p",{className:"text-sm mb-4 max-w-xs",style:{color:"var(--text-muted)"},children:"Create your first DCA strategy to automatically invest in tokens on a regular schedule."}),e.jsxs("button",{onClick:s,className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-colors",style:{background:"var(--accent)",color:"var(--text-inverse)"},children:[e.jsx(q,{className:"h-4 w-4"}),"Create Strategy"]})]})}const Ce=["hourly","daily","weekly","biweekly","monthly"],Ee=Array.from({length:24},(s,a)=>({value:a,label:`${a.toString().padStart(2,"0")}:00 UTC`})),Ue=[{value:0,label:"Sunday"},{value:1,label:"Monday"},{value:2,label:"Tuesday"},{value:3,label:"Wednesday"},{value:4,label:"Thursday"},{value:5,label:"Friday"},{value:6,label:"Saturday"}],M=[{symbol:"USDC",address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",chainId:1,decimals:6},{symbol:"USDT",address:"0xdAC17F958D2ee523a2206206994597C13D831ec7",chainId:1,decimals:6},{symbol:"ETH",address:"0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE",chainId:1,decimals:18},{symbol:"WBTC",address:"0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",chainId:1,decimals:8},{symbol:"LINK",address:"0x514910771AF9Ca656af840dff83E8264EcF986CA",chainId:1,decimals:18}];function $({initialData:s,onSubmit:a,onCancel:n,isSubmitting:c=!1,mode:o="create"}){const[l,h]=d.useState({...ue,...s}),[f,y]=d.useState(!1),[m,j]=d.useState({}),p=d.useCallback((t,u)=>{h(x=>({...x,[t]:u})),j(x=>({...x,[t]:""}))},[]),r=d.useCallback(()=>{const t={};return l.name.trim()||(t.name="Name is required"),l.fromToken||(t.fromToken="Select a token to spend"),l.toToken||(t.toToken="Select a token to buy"),l.fromToken&&l.toToken&&l.fromToken.address===l.toToken.address&&(t.toToken="Cannot buy the same token"),l.amountPerExecutionUsd<=0&&(t.amountPerExecutionUsd="Amount must be greater than 0"),(l.maxSlippageBps<10||l.maxSlippageBps>1e3)&&(t.maxSlippageBps="Slippage must be between 0.1% and 10%"),l.maxGasUsd<=0&&(t.maxGasUsd="Max gas must be greater than 0"),j(t),Object.keys(t).length===0},[l]),i=async t=>{t.preventDefault(),r()&&await a(l)};return e.jsxs("form",{onSubmit:i,className:"space-y-6",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",style:{color:"var(--text)"},children:"Strategy Details"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Strategy Name"}),e.jsx("input",{type:"text",value:l.name,onChange:t=>p("name",t.target.value),placeholder:"e.g., Weekly ETH DCA",className:"w-full px-3 py-2 rounded-lg text-sm outline-none",style:{background:"var(--surface-2)",border:m.name?"1px solid var(--error)":"1px solid var(--line)",color:"var(--text)"}}),m.name&&e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--error)"},children:m.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Description (optional)"}),e.jsx("textarea",{value:l.description??"",onChange:t=>p("description",t.target.value),placeholder:"What is this strategy for?",rows:2,className:"w-full px-3 py-2 rounded-lg text-sm outline-none resize-none",style:{background:"var(--surface-2)",border:"1px solid var(--line)",color:"var(--text)"}})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",style:{color:"var(--text)"},children:"Tokens"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Spend"}),e.jsx(_,{value:l.fromToken,onChange:t=>p("fromToken",t),tokens:M.filter(t=>["USDC","USDT","ETH"].includes(t.symbol)),error:m.fromToken})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Buy"}),e.jsx(_,{value:l.toToken,onChange:t=>p("toToken",t),tokens:M,error:m.toToken})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",style:{color:"var(--text)"},children:"Investment"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Amount per buy"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4",style:{color:"var(--text-muted)"}}),e.jsx("input",{type:"number",value:l.amountPerExecutionUsd,onChange:t=>p("amountPerExecutionUsd",parseFloat(t.target.value)||0),min:1,step:10,className:"w-full pl-9 pr-3 py-2 rounded-lg text-sm outline-none",style:{background:"var(--surface-2)",border:m.amountPerExecutionUsd?"1px solid var(--error)":"1px solid var(--line)",color:"var(--text)"}})]}),m.amountPerExecutionUsd&&e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--error)"},children:m.amountPerExecutionUsd})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Frequency"}),e.jsx("select",{value:l.frequency,onChange:t=>p("frequency",t.target.value),className:"w-full px-3 py-2 rounded-lg text-sm outline-none cursor-pointer",style:{background:"var(--surface-2)",border:"1px solid var(--line)",color:"var(--text)"},children:Ce.map(t=>e.jsx("option",{value:t,children:H[t]},t))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Time of day"}),e.jsx("select",{value:l.executionHourUtc,onChange:t=>p("executionHourUtc",parseInt(t.target.value)),className:"w-full px-3 py-2 rounded-lg text-sm outline-none cursor-pointer",style:{background:"var(--surface-2)",border:"1px solid var(--line)",color:"var(--text)"},children:Ee.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),(l.frequency==="weekly"||l.frequency==="biweekly")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Day of week"}),e.jsx("select",{value:l.executionDayOfWeek??1,onChange:t=>p("executionDayOfWeek",parseInt(t.target.value)),className:"w-full px-3 py-2 rounded-lg text-sm outline-none cursor-pointer",style:{background:"var(--surface-2)",border:"1px solid var(--line)",color:"var(--text)"},children:Ue.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]})]}),e.jsxs("section",{children:[e.jsxs("button",{type:"button",onClick:()=>y(!f),className:"flex items-center gap-2 text-sm font-medium",style:{color:"var(--accent)"},children:[e.jsx(le,{className:"h-4 w-4"}),"Advanced Settings",f?e.jsx(ne,{className:"h-4 w-4"}):e.jsx(G,{className:"h-4 w-4"})]}),f&&e.jsxs("div",{className:"mt-4 p-4 rounded-lg space-y-4",style:{background:"var(--surface-2)"},children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-1 text-xs mb-1.5",style:{color:"var(--text-muted)"},children:["Max Slippage",e.jsx(ee,{className:"h-3 w-3"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",value:l.maxSlippageBps,onChange:t=>p("maxSlippageBps",parseInt(t.target.value)),min:10,max:500,step:10,className:"flex-1"}),e.jsxs("span",{className:"text-sm w-12 text-right",style:{color:"var(--text)"},children:[(l.maxSlippageBps/100).toFixed(1),"%"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Max gas per execution"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4",style:{color:"var(--text-muted)"}}),e.jsx("input",{type:"number",value:l.maxGasUsd,onChange:t=>p("maxGasUsd",parseFloat(t.target.value)||0),min:1,step:1,className:"w-full pl-9 pr-3 py-2 rounded-lg text-sm outline-none",style:{background:"var(--surface)",border:"1px solid var(--line)",color:"var(--text)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Skip execution if gas above (optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4",style:{color:"var(--text-muted)"}}),e.jsx("input",{type:"number",value:l.skipIfGasAboveUsd??"",onChange:t=>p("skipIfGasAboveUsd",t.target.value?parseFloat(t.target.value):void 0),min:1,step:1,placeholder:"No limit",className:"w-full pl-9 pr-3 py-2 rounded-lg text-sm outline-none",style:{background:"var(--surface)",border:"1px solid var(--line)",color:"var(--text)"}})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs mb-1.5",style:{color:"var(--text-muted)"},children:"Total budget limit (optional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4",style:{color:"var(--text-muted)"}}),e.jsx("input",{type:"number",value:l.maxTotalSpendUsd??"",onChange:t=>p("maxTotalSpendUsd",t.target.value?parseFloat(t.target.value):void 0),min:l.amountPerExecutionUsd,step:100,placeholder:"No limit",className:"w-full pl-9 pr-3 py-2 rounded-lg text-sm outline-none",style:{background:"var(--surface)",border:"1px solid var(--line)",color:"var(--text)"}})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",style:{borderTop:"1px solid var(--line)"},children:[e.jsx("button",{type:"button",onClick:n,disabled:c,className:"flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",style:{background:"var(--surface-2)",color:"var(--text)",border:"1px solid var(--line)"},children:"Cancel"}),e.jsx("button",{type:"submit",disabled:c,className:"flex-1 px-4 py-2.5 rounded-lg text-sm font-medium transition-colors disabled:opacity-50",style:{background:"var(--accent)",color:"var(--text-inverse)"},children:c?"Saving...":o==="create"?"Create Strategy":"Save Changes"})]})]})}function _({value:s,onChange:a,tokens:n,error:c}){const[o,l]=d.useState(!1);return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",onClick:()=>l(!o),className:"w-full flex items-center justify-between px-3 py-2 rounded-lg text-sm",style:{background:"var(--surface-2)",border:c?"1px solid var(--error)":"1px solid var(--line)",color:s?"var(--text)":"var(--text-muted)"},children:[e.jsx("span",{children:(s==null?void 0:s.symbol)??"Select token"}),e.jsx(G,{className:"h-4 w-4",style:{color:"var(--text-muted)"}})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>l(!1)}),e.jsx("div",{className:"absolute left-0 right-0 top-full mt-1 z-20 rounded-lg py-1 shadow-lg max-h-48 overflow-y-auto",style:{background:"var(--surface)",border:"1px solid var(--line)"},children:n.map(h=>e.jsxs("button",{type:"button",onClick:()=>{a(h),l(!1)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-black/5 text-left",style:{color:"var(--text)",background:(s==null?void 0:s.address)===h.address?"var(--accent-muted)":void 0},children:[e.jsx("div",{className:"h-6 w-6 rounded-full flex items-center justify-center text-xs font-bold",style:{background:"var(--surface-2)",color:"var(--text-muted)"},children:h.symbol.charAt(0)}),h.symbol]},h.address))})]}),c&&e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--error)"},children:c})]})}function Me({walletAddress:s,userId:a,walletId:n}){const[c,o]=d.useState("list"),[l,h]=d.useState(null),[f,y]=d.useState({status:"all",sortBy:"created",sortOrder:"desc"}),[m,j]=d.useState(!1),{strategies:p,isLoading:r,isEmpty:i}=me(s,f),{create:t,pause:u,resume:x,stop:g,updateConfig:A}=pe(),v=p.find(b=>b._id===l),W=d.useCallback(()=>{o("create")},[]),S=d.useCallback(()=>{o("list"),h(null)},[]),R=d.useCallback(b=>{h(b),o("details")},[]),z=d.useCallback(b=>{h(b),o("edit")},[]),D=d.useCallback(async b=>{await u(b)},[u]),P=d.useCallback(async b=>{await x(b)},[x]),I=d.useCallback(async b=>{await g(b)},[g]),Q=d.useCallback(async b=>{if(!a||!n||!s){console.error("Missing user/wallet info");return}j(!0);try{await t(a,n,s,b),o("list")}finally{j(!1)}},[t,a,n,s]),V=d.useCallback(async b=>{if(l){j(!0);try{await A(l,b),o("list"),h(null)}finally{j(!1)}}},[A,l]);return s?e.jsx("div",{className:"flex flex-col h-full",children:e.jsxs(se,{mode:"wait",children:[c==="list"&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex-1 min-h-0",children:e.jsx(we,{strategies:p,isLoading:r,isEmpty:i,filters:f,onFiltersChange:y,onCreateNew:W,onPause:D,onResume:P,onStop:I,onEdit:z,onViewDetails:R})},"list"),c==="create"&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(T,{title:"Create Strategy",onBack:S}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx($,{onSubmit:Q,onCancel:S,isSubmitting:m,mode:"create"})})]},"create"),c==="edit"&&v&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(T,{title:"Edit Strategy",onBack:S}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx($,{initialData:{name:v.name,description:v.description,fromToken:v.fromToken,toToken:v.toToken,amountPerExecutionUsd:v.amountPerExecutionUsd,frequency:v.frequency,cronExpression:v.cronExpression,executionHourUtc:v.executionHourUtc,executionDayOfWeek:v.executionDayOfWeek,executionDayOfMonth:v.executionDayOfMonth,maxSlippageBps:v.maxSlippageBps,maxGasUsd:v.maxGasUsd,skipIfGasAboveUsd:v.skipIfGasAboveUsd,pauseIfPriceAboveUsd:v.pauseIfPriceAboveUsd,pauseIfPriceBelowUsd:v.pauseIfPriceBelowUsd,maxTotalSpendUsd:v.maxTotalSpendUsd,maxExecutions:v.maxExecutions,endDate:v.endDate},onSubmit:V,onCancel:S,isSubmitting:m,mode:"edit"})})]},"edit"),c==="details"&&v&&e.jsxs(E.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"flex-1 min-h-0 flex flex-col",children:[e.jsx(T,{title:v.name,onBack:S}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:e.jsx(Te,{strategy:v,onEdit:()=>o("edit"),onPause:()=>D(v._id),onResume:()=>P(v._id),onStop:()=>I(v._id)})})]},"details")]})}):e.jsx("div",{className:"flex flex-col items-center justify-center h-full p-8 text-center",children:e.jsx("p",{className:"text-sm",style:{color:"var(--text-muted)"},children:"Connect your wallet to view and manage DCA strategies."})})}function T({title:s,onBack:a}){return e.jsxs("div",{className:"shrink-0 flex items-center gap-3 px-4 py-3",style:{borderBottom:"1px solid var(--line)"},children:[e.jsx("button",{onClick:a,className:"p-1.5 rounded-md hover:bg-black/5 transition-colors",children:e.jsx(oe,{className:"h-4 w-4",style:{color:"var(--text-muted)"}})}),e.jsx("h2",{className:"font-medium",style:{color:"var(--text)"},children:s})]})}function Te({strategy:s,onEdit:a,onPause:n,onResume:c,onStop:o}){const l=s.status==="draft"||s.status==="paused",h=s.status==="active",f=s.status==="paused",y=s.status==="active"||s.status==="paused";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(U,{label:"Total Spent",value:`$${s.totalAmountSpentUsd.toLocaleString()}`}),e.jsx(U,{label:"Tokens Acquired",value:`${parseFloat(s.totalTokensAcquired).toFixed(4)} ${s.toToken.symbol}`}),e.jsx(U,{label:"Successful",value:`${s.successfulExecutions}/${s.totalExecutions}`}),e.jsx(U,{label:"Avg Price",value:s.averagePriceUsd?`$${s.averagePriceUsd.toFixed(2)}`:"N/A"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",style:{color:"var(--text)"},children:"Configuration"}),e.jsxs("div",{className:"rounded-lg p-3 space-y-2 text-sm",style:{background:"var(--surface-2)"},children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Amount per buy"}),e.jsxs("span",{style:{color:"var(--text)"},children:["$",s.amountPerExecutionUsd]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Frequency"}),e.jsx("span",{style:{color:"var(--text)"},children:s.frequency})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Max slippage"}),e.jsxs("span",{style:{color:"var(--text)"},children:[(s.maxSlippageBps/100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{style:{color:"var(--text-muted)"},children:"Max gas"}),e.jsxs("span",{style:{color:"var(--text)"},children:["$",s.maxGasUsd]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[l&&e.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg text-sm font-medium",style:{background:"var(--surface-2)",color:"var(--text)",border:"1px solid var(--line)"},children:"Edit"}),h&&e.jsx("button",{onClick:n,className:"px-4 py-2 rounded-lg text-sm font-medium",style:{background:"var(--warning)",color:"white"},children:"Pause"}),f&&e.jsx("button",{onClick:c,className:"px-4 py-2 rounded-lg text-sm font-medium",style:{background:"var(--success)",color:"white"},children:"Resume"}),y&&e.jsx("button",{onClick:o,className:"px-4 py-2 rounded-lg text-sm font-medium",style:{background:"var(--error)",color:"white"},children:"Stop"})]})]})}function U({label:s,value:a}){return e.jsxs("div",{className:"rounded-lg p-3",style:{background:"var(--surface-2)"},children:[e.jsx("p",{className:"text-xs mb-1",style:{color:"var(--text-muted)"},children:s}),e.jsx("p",{className:"text-sm font-medium",style:{color:"var(--text)"},children:a})]})}export{Me as StrategiesWidget};
